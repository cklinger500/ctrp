<div class="row">
    <div class="col-xs-12 drop-shadow">
        <div class="row">
            <h4>Add Participating Site</h4>
        </div>
        <div class="row">
            <form class="form form-horizontal" role="form">
                <div class="form-group">
                    <label class="control-label col-xs-12 col-sm-3">NCI ID:</label>
                    <div class="col-xs-12 col-sm-6 form-text">
                        {{psDetailView.curTrial.nci_id}}
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-xs-12 col-sm-3">Lead Organization Trial Identifier:</label>
                    <div class="col-xs-12 col-sm-6 form-text">
                        {{psDetailView.curTrial.lead_protocol_id}}
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-xs-12 col-sm-3">Official Title:</label>
                    <div class="col-xs-12 col-sm-6 form-text">
                        {{psDetailView.curTrial.official_title}}
                    </div>
                </div>

                <div class="form-group required" ng-class="{'has-error': ctrpbtn.trial_form.needsAttention(trial_form.ts_dummy)}">
                    <label class="control-label col-xs-12 col-sm-3">Trial Recruitment Status:</label>
                    <div class="col-xs-12 col-sm-8">
                        <table class="table table-striped table-condensed">
                            <thead>
                            <th>Status Date</th>
                            <th>Status</th>
                            <th>Comment</th>
                            <th></th>
                            </thead>
                            <tbody>
                            <tr>
                                <td class="col-md-3">
                                    <div class="input-group add-on date datepicker" date-date-format="yyyy-mm-dd">
                                        <input restriction-field type="text" class="form-control input-sm" datepicker-popup="{{psDetailView.dateFormat}}" ng-model="psDetailView.status_date"
                                               ng-click="psDetailView.openCalendar($event, 'status_date')" is-open="psDetailView.status_date_opened" datepicker-options="psDetailView.dateOptions" ng-required="false" close-text="Close">
                                        <span class="input-group-btn">
                                            <button restriction-field type="button" class="btn btn-default" ng-click="psDetailView.openCalendar($event, 'status_date')">
                                                <i class="glyphicon glyphicon-calendar"></i>
                                            </button>
                                        </span>
                                    </div>
                                </td>
                                <td class="col-md-4">
                                    <div>
                                        <select restriction-field class="form-control input-sm" id="sr_status" ng-model="psDetailView.sr_status_id"  ng-change="psDetailView.watchOption('sr_status')">
                                            <option value="">-Select a Trial Status-</option>
                                            <option ng-repeat="srStatus in psDetailView.srStatusArr" value="{{srStatus.id}}">
                                                {{srStatus.name}}
                                            </option>
                                        </select>
                                    </div>
                                </td>
                                <td class="col-md-4">
                                    <div>
                                        <textarea restriction-field style="resize: vertical;" class="form-control input-sm" id="status_comment" ng-model="psDetailView.status_comment" />
                                    </div>
                                </td>
                                <td class="col-md-1">
                                    <div>
                                        <button type="button" restriction-field class="btn btn-primary" ng-click="psDetailView.addStatus()">
                                            <i class="glyphicon glyphicon-plus"></i> Add
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                        <input type="hidden" name="ts_dummy" ng-model="psDetailView.dummyField" ng-required="psDetailView.srsNum === 0">
                        <input type="hidden" name="ts_dummy2" ng-model="psDetailView.statusValidationMsgs" validate-trial-status>
                        <span class="help-block" ng-show="ctrpbtn.trial_form.needsAttention(trial_form.ts_dummy)">
                            Site Recruitment Status is required
                        </span>

                        <div class="add-association-error" ng-show="psDetailView.showAddStatusError">
                            Please provide a Status Date and select a Status
                        </div>

                        <table class="table table-bordered table-striped table-condensed" ng-show="psDetailView.addedStatuses.length > 0">
                            <thead>
                                <th>Status Date</th>
                                <th>Status</th>
                                <th>Comment</th>
                                <th>Errors/Warnings</th>
                                <th></th>
                            </thead>
                            <tbody>
                                <tr ng-repeat="status in psDetailView.addedStatuses track by $index" ng-class="status._destroy == true ? 'deleted-text animated-item' : 'animated-item'">
                                    <td class="col-md-2">{{status.status_date}}</td>
                                    <td class="col-md-2">{{status.sr_status_name}}</td>
                                    <td class="col-md-2">{{status.comment}}</td>
                                    <td class="col-md-5">
                                        <div class="text-danger" ng-repeat="error in psDetailView.statusValidationMsgs[$index].errors" ng-if="error.hasOwnProperty('status')">
                                            ERROR: Interim status [{{error.status}}] is missing
                                        </div>
                                        <div class="text-danger" ng-repeat="error in psDetailView.statusValidationMsgs[$index].errors" ng-if="error.hasOwnProperty('message')">
                                            ERROR: {{error.message}}
                                        </div>
                                        <div class="text-warning" ng-repeat="warning in psDetailView.statusValidationMsgs[$index].warnings" ng-if="warning.hasOwnProperty('status')">
                                            WARNING: Interim status [{{warning.status}}] is missing
                                        </div>
                                        <div class="text-warning" ng-repeat="warning in psDetailView.statusValidationMsgs[$index].warnings" ng-if="warning.hasOwnProperty('message')">
                                            WARNING: {{warning.message}}
                                        </div>
                                    </td>
                                    <td class="col-md-1" style="vertical-align: middle">
                                        <label restriction-field class="btn btn-default" ng-click="psDetailView.toggleSelection($index, 'sr_status')">
                                            <i ng-class="status._destroy == true ? 'glyphicon glyphicon-ok-circle' : 'glyphicon glyphicon-remove-circle'"></i>
                                        </label>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
